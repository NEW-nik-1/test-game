<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IPTV, –†–∞–¥–∏–æ –∏ –ò–≥—Ä—ã</title>
<style>
  /* –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–∑–∞–º–µ–Ω–∏—Ç–µ URL) */
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: url('https://your-background-image-url.com/background.jpeg') center center / cover no-repeat fixed;
    color: white;
    user-select: none;
    overflow-x: hidden;
  }
  /* –®–∞–ø–∫–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É, –≥—Ä–∞–¥–∏–µ–Ω—Ç —á—ë—Ä–Ω–æ-—Å–µ—Ä—ã–π */
  header {
    position: fixed; top: 0; left: 0; right: 0;
    height: 48px;
    background: linear-gradient(90deg, #000000 0%, #555555 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    z-index: 3000;
    user-select: none;
  }
  header button {
    min-width: 80px;
    padding: 8px 18px;
    background: linear-gradient(180deg, #222, #111);
    border: 1px solid #666;
    border-radius: 5px;
    font-weight: bold;
    font-size: 1rem;
    cursor: pointer;
    color: white;
    transition: background-color 0.3s, color 0.3s;
    user-select: none;
  }
  header button.active {
    background: linear-gradient(180deg, #bbb, #ddd);
    color: #000;
  }
  header button.recording {
    background-color: #c00 !important;
    color: white !important;
  }
  /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
  main {
    margin-top: 48px;
    display: flex;
    justify-content: center;
    gap: 12px;
    padding-bottom: 64px;
  }
  /* –¢–í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
  #tv-container {
    display: none;
    flex-direction: column;
    width: 360px;
    max-height: 520px;
    background: linear-gradient(180deg, #222, #111);
    border-radius: 8px;
    box-shadow: 0 0 15px #000;
    user-select: none;
  }
  #tv-video {
    width: 100%;
    height: 200px;
    background: black;
    border-radius: 8px 8px 0 0;
    outline: none;
  }
  #tv-channels-list {
    flex-grow: 1;
    background: #0c0c0c;
    padding: 4px 8px;
    overflow-y: auto;
    border-top: 1px solid #444;
    border-radius: 0 0 8px 8px;
    max-height: 300px;
  }
  #tv-channels-list h3 {
    text-align: center;
    user-select: none;
    margin: 8px auto 6px;
    font-weight: bold;
    border: 2px solid #555;
    padding: 4px 0;
    width: 60%;
    border-radius: 8px;
  }
  #tv-channels-list h3.music {
    border-color: #4caf50;
  }
  #tv-channels-list h3.cinema {
    border-color: #2196f3;
  }
  #tv-channels-list .channel-item {
    text-align: center;
    padding: 6px 0;
    cursor: pointer;
    border-radius: 6px;
  }
  #tv-channels-list .channel-item:hover {
    background-color: #333;
  }
  #tv-channels-list .channel-item.active {
    font-weight: 700;
    background-color: #555;
  }
  /* –†–∞–¥–∏–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
  #radio-container {
    display: none;
    flex-direction: column;
    width: 360px;
    max-height: 520px;
    background: linear-gradient(180deg, #222, #111);
    border-radius: 8px;
    box-shadow: 0 0 15px #000;
    user-select: none;
  }
  #radio-player {
    width: 100%;
    border-radius: 8px 8px 0 0;
    background: black;
    outline: none;
  }
  #radio-list {
    flex-grow: 1;
    background: #0a0a0a;
    padding: 8px 6px;
    max-height: 300px;
    overflow-y: auto;
    border-top: 1px solid #444;
    border-radius: 0 0 8px 8px;
  }
  #radio-list .radio-item {
    text-align: center;
    padding: 10px 0;
    cursor: pointer;
    border-radius: 5px;
  }
  #radio-list .radio-item:hover {
    background: #444;
  }
  #radio-list .radio-item.active {
    background: #888888bb;
    font-weight: 700;
    color: #ddd;
  }
  /* –ò–≥—Ä—ã - –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –º–µ–Ω—é */
  #games-overlay {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 420px;
    max-height: 75vh;
    background: linear-gradient(180deg, #222, #000);
    border-radius: 12px;
    box-shadow: 0 0 30px #000;
    display: flex;
    flex-direction: column;
    color: white;
    user-select: none;
    z-index: 5000;
  }
  #games-overlay.hidden {
    display: none;
  }
  #games-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 14px;
    font-weight: bold;
    font-size: 1.1rem;
    border-bottom: 1px solid #555;
  }
  #games-close {
    cursor: pointer;
    font-size: 1.5rem;
    color: #ccc;
    user-select: none;
  }
  #games-close:hover {
    color: white;
  }
  #games-list {
    flex-grow: 1;
    overflow-y: auto;
    padding: 12px 14px;
  }
  #games-list .game-item {
    padding: 12px 8px;
    text-align: center;
    cursor: pointer;
    border-radius: 10px;
    border-bottom: 1px solid #555;
  }
  #games-list .game-item:hover {
    background-color: #333;
  }
  /* –ò–≥—Ä–æ–≤–æ–µ –æ–∫–Ω–æ */
  #game-window {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 80vw;
    height: 80vh;
    background: black;
    border-radius: 10px;
    box-shadow: 0 0 40px #000;
    display: none;
    flex-direction: column;
    z-index: 6000;
  }
  #game-window.show {
    display: flex;
  }
  #game-topbar {
    background: #222;
    display: flex;
    justify-content: flex-end;
    gap: 14px;
    padding: 6px 12px;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    color: #ddd;
    user-select: none;
  }
  #game-topbar span.btn-icon {
    font-weight: bold;
    font-size: 1.3rem;
    cursor: pointer;
    color: #aaa;
    line-height: 1;
  }
  #game-topbar span.btn-icon:hover {
    color: white;
  }
  #game-topbar span.tooltip {
    position: relative;
  }
  #game-topbar span.tooltip:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    top: -28px;
    left: 50%;
    transform: translateX(-50%);
    padding: 3px 7px;
    border-radius: 4px;
    background: #444;
    font-size: 0.75rem;
    white-space: nowrap;
    color: #eee;
    pointer-events: none;
  }
  #game-iframe {
    flex-grow: 1;
    border: none;
    border-bottom-left-radius: 10px;
    border-bottom-right-radius: 10px;
    background: black;
  }
  /* –°–∫—Ä–æ–ª–ª–±–∞—Ä—ã */
  #tv-channels-list::-webkit-scrollbar,
  #radio-list::-webkit-scrollbar,
  #games-list::-webkit-scrollbar {
    width: 8px;
  }
  #tv-channels-list::-webkit-scrollbar-thumb,
  #radio-list::-webkit-scrollbar-thumb,
  #games-list::-webkit-scrollbar-thumb {
    background-color: #555;
    border-radius: 4px;
  }
  /* –ù–∏–∂–Ω–∏–π –ø—Ä–∞–≤—ã–π –º–µ–ª–∫–∏–π —à—Ä–∏—Ñ—Ç */
  footer {
    position: fixed;
    bottom: 8px;
    right: 10px;
    font-size: 0.7rem;
    color: #999999cc;
    user-select: none;
    pointer-events: none;
    font-family: monospace;
  }
</style>
</head>
<body>

<header role="banner" aria-label="–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é">
  <button id="btn-tv" aria-pressed="false" title="–í–∫–ª—é—á–∏—Ç—å –¢–í">–¢–í</button>
  <button id="btn-radio" aria-pressed="false" title="–í–∫–ª—é—á–∏—Ç—å –†–∞–¥–∏–æ">–†–ê–î–ò–û</button>
  <button id="btn-games" aria-pressed="false" title="–û—Ç–∫—Ä—ã—Ç—å –ò–≥—Ä—ã">–ò–ì–†–´</button>
</header>

<main>
  <section id="tv-container" role="region" aria-label="–¢–µ–ª–µ–≤–∏–∑–∏–æ–Ω–Ω—ã–π –ø–ª–µ–µ—Ä –∏ —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤" tabindex="0">
    <video id="tv-video" muted playsinline controls></video>
    <div id="tv-channels-list" aria-label="–°–ø–∏—Å–æ–∫ —Ç–µ–ª–µ–≤–∏–∑–∏–æ–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤" tabindex="0">
      <h3 class="music" tabindex="-1">_üéµ_ –ú–£–ó–´–ö–ê _üéµ_</h3>
      <div class="channel-item" tabindex="0" data-url="http://stream.mediawork.cz/retrotv/retrotvHQ1/playlist.m3u8">Retro TV</div>
      <div class="channel-item" tabindex="0" data-url="https://hls-03-video.webcaramba.com/rutv/live_480/index.m3u8">RU TV</div>
      <div class="channel-item" tabindex="0" data-url="http://streamer.rtcommufa.ru:1935/ptica/ptica1/playlist.m3u8">Ptica 1</div>
      <div class="channel-item" tabindex="0" data-url="http://live.stranafm.cdnvideo.ru/stranafm/stranafm_hd.sdp/playlist.m3u8">Strana FM HD</div>
      <div class="channel-item" tabindex="0" data-url="http://tntmsmotr.mediacdn.ru/cdn/smotr/playlist_hdhigh.m3u8">TNT High</div>
      <div class="channel-item" tabindex="0" data-url="https://hls-shansontv.cdnvideo.ru/shansontv/shansontv-sd.smil/playlist.m3u8">Shanson TV</div>
      <h3 class="cinema" tabindex="-1">_üé¨_ –ö–ò–ù–û _üé¨_</h3>
      <div class="channel-item" tabindex="0" data-url="http://live-nikatv.cdnvideo.ru/nikatv/nikatv.sdp/playlist.m3u8">Nika TV</div>
      <div class="channel-item" tabindex="0" data-url="https://zabava-htlive.cdn.ngenix.net/hls/CH_TV3/variant.m3u8">TV 3</div>
      <div class="channel-item" tabindex="0" data-url="http://rt-mos-htlive.cdn.ngenix.net/hls/CH_R04_DOVERIE/variant.m3u8">DOVERIE</div>
    </div>
  </section>

  <section id="radio-container" role="region" aria-label="–†–∞–¥–∏–æ –ø–ª–µ–µ—Ä –∏ —Å–ø–∏—Å–æ–∫ —Ä–∞–¥–∏–æ–∫–∞–Ω–∞–ª–æ–≤" tabindex="0">
    <audio id="radio-player" controls preload="auto"></audio>
    <div id="radio-list" aria-label="–°–ø–∏—Å–æ–∫ —Ä–∞–¥–∏–æ–∫–∞–Ω–∞–ª–æ–≤" tabindex="0">
      <div class="radio-item" tabindex="0" data-src="https://dorognoe.hostingradio.ru/radio">–î–æ—Ä–æ–∂–Ω–æ–µ —Ä–∞–¥–∏–æ</div>
      <div class="radio-item" tabindex="0" data-src="https://online2.100i6fm.ru/city">–†–∞–¥–∏–æ –°–ò–¢–ò</div>
      <div class="radio-item" tabindex="0" data-src="https://pub0101.101.ru/stream/air/aac/64/100">–ê–≤—Ç–æ—Ä–∞–¥–∏–æ</div>
      <div class="radio-item" tabindex="0" data-src="https://radiorecord.hostingradio.ru/rr_main96.aacp">–†–∞–¥–∏–æ –†–µ–∫–æ—Ä–¥</div>
      <div class="radio-item" tabindex="0" data-src="https://stream.newradio.ru/novoe96.aacp">–ù–æ–≤–æ–µ —Ä–∞–¥–∏–æ</div>
      <div class="radio-item" tabindex="0" data-src="https://retro.hostingradio.ru:8043/retro256.mp3">–†–µ—Ç—Ä–æ –§–ú</div>
      <div class="radio-item" tabindex="0" data-src="https://pub0202.101.ru:8443/stream/air/aac/64/99">–†–∞–¥–∏–æ Energy</div>
      <div class="radio-item" tabindex="0" data-src="https://ep256.hostingradio.ru:8052/europaplus256.mp3">–ï–≤—Ä–æ–ø–∞ –ø–ª—é—Å</div>
      <div class="radio-item" tabindex="0" data-src="https://nashe1.hostingradio.ru/nashe-256">–ù–∞—à–µ —Ä–∞–¥–∏–æ</div>
      <div class="radio-item" tabindex="0" data-src="https://myradio24.org/5129">BEST DEEP FM</div>
      <div class="radio-item" tabindex="0" data-src="https://rusradio.hostingradio.ru/rusradio96.aacp">–†—É—Å—Å–∫–æ–µ —Ä–∞–¥–∏–æ</div>
    </div>
  </section>
</main>

<!-- –ò–≥—Ä—ã -->
<div id="games-overlay" class="hidden" role="dialog" aria-modal="true" aria-label="–ú–µ–Ω—é –ò–≥—Ä—ã">
  <div id="games-header">
    <span>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</span>
    <span id="games-close" role="button" tabindex="0" aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é –∏–≥—Ä">‚úñ</span>
  </div>
  <div id="games-list" tabindex="0" aria-label="–°–ø–∏—Å–æ–∫ –∏–≥—Ä">
    <div class="game-item" tabindex="0" data-url="https://html5.gamemonetize.co/dd5rs8etri5hw51g32sk69qfdoov5tq2/">Gary's World</div>
    <div class="game-item" tabindex="0" data-url="https://www.onlinegames.io/games/2021/unity2/crazy-ball-adventures/index.html">crazy-ball-adventures</div>
    <div class="game-item" tabindex="0" data-url="https://www.gamenora.com/embed/subway-horror-chapter-1">subway-horror-chapter</div>
    <div class="game-item" tabindex="0" data-url="https://www.gamenora.com/embed/a-difficult-game-about-climbing">A Difficult Game About Climbing</div>
    <div class="game-item" tabindex="0" data-url="https://www.onlinegames.io/games/2023/unity/cross-the-road/index.html">cross-the-road</div>
    <div class="game-item" tabindex="0" data-url="https://s3.eponesh.com/games/8866/">motorcycle racer</div>
    <div class="game-item" tabindex="0" data-url="https://app-165758.games.s3.yandex.net/165758/ghtg4xyuxt09og6gtji0jcl6aw8el4w4/index.html">Moto Rider GO</div>
  </div>
</div>

<!-- –ò–≥—Ä–æ–≤–æ–µ –æ–∫–Ω–æ -->
<div id="game-window" role="region" aria-label="–û–∫–Ω–æ –ò–≥—Ä—ã" aria-live="polite">
  <div id="game-topbar">
    <span id="game-minimize" role="button" tabindex="0" aria-label="–û–ø—É—Å—Ç–∏—Ç—å –æ–∫–Ω–æ ‚ñΩ" class="btn-icon">‚ñΩ</span>
    <span id="game-maximize" role="button" tabindex="0" aria-label="–í–µ—Ä–Ω—É—Ç—å –æ–∫–Ω–æ ‚ñ≥" class="btn-icon" style="display:none;">‚ñ≥</span>
    <span id="game-sound-toggle" role="button" tabindex="0" aria-label="–ü–æ–¥—Å–∫–∞–∑–∫–∞: —á—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã" class="btn-icon tooltip" data-tooltip="–û—Ç–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ - –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏–≥—Ä—ã">?</span>
    <span id="game-fullscreen" role="button" tabindex="0" aria-label="–í–∫–ª—é—á–∏—Ç—å –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º" class="btn-icon tooltip" data-tooltip="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º">‚ùè</span>
    <span id="game-fullscreen-exit" role="button" tabindex="0" aria-label="–í—ã–π—Ç–∏ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞" class="btn-icon tooltip" data-tooltip="–í—ã–π—Ç–∏ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞" style="display:none;">‚ùè</span>
    <span id="game-close" role="button" tabindex="0" aria-label="–ó–∞–∫—Ä—ã—Ç—å –∏–≥—Ä—É" class="btn-icon">‚úñ</span>
  </div>
  <iframe id="game-iframe" sandbox="allow-scripts allow-same-origin allow-forms allow-pointer-lock allow-popups" allowfullscreen tabindex="0" frameborder="0"></iframe>
</div>

<footer>–ü—Ä–æ–µ–∫—Ç —Å–¥–µ–ª–∞–Ω, –ø—Ä–∏–¥—É–º–∞–Ω ?</footer>

<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.1/dist/hls.min.js"></script>
<script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>

<script>
  vkBridge.send('VKWebAppInit');

  (() => {
    const btnTv = document.getElementById('btn-tv');
    const btnRadio = document.getElementById('btn-radio');
    const btnGames = document.getElementById('btn-games');

    const tvContainer = document.getElementById('tv-container');
    const tvVideo = document.getElementById('tv-video');
    const tvChannelsList = document.getElementById('tv-channels-list');

    const radioContainer = document.getElementById('radio-container');
    const radioPlayer = document.getElementById('radio-player');
    const radioList = document.getElementById('radio-list');

    const gamesOverlay = document.getElementById('games-overlay');
    const gamesClose = document.getElementById('games-close');
    const gamesList = document.getElementById('games-list');

    const gameWindow = document.getElementById('game-window');
    const gameIframe = document.getElementById('game-iframe');
    const gameMinimize = document.getElementById('game-minimize');
    const gameMaximize = document.getElementById('game-maximize');
    const gameSoundToggle = document.getElementById('game-sound-toggle');
    const gameFullscreen = document.getElementById('game-fullscreen');
    const gameFullscreenExit = document.getElementById('game-fullscreen-exit');
    const gameClose = document.getElementById('game-close');

    let hls = null;
    let currentTvUrl = null;
    let currentRadioSrc = null;
    let isRecording = false;
    let mediaRecorder = null;
    let recordedChunks = [];

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
    function clearActiveButtons() {
      [btnTv, btnRadio, btnGames].forEach(btn => {
        btn.classList.remove('active', 'recording');
        btn.setAttribute('aria-pressed', 'false');
      });
    }
    // –¢–í —Ñ—É–Ω–∫—Ü–∏–∏
    function showTv() {
      tvContainer.style.display = 'flex';
      radioContainer.style.display = 'none';
      clearActiveButtons();
      btnTv.classList.add('active');
      btnTv.setAttribute('aria-pressed', 'true');
      gamesOverlay.classList.add('hidden');

      if (!currentTvUrl) {
        const first = tvChannelsList.querySelector('.channel-item');
        if (first) playTvChannel(first.dataset.url, first);
      } else {
        playTvChannel(currentTvUrl, tvChannelsList.querySelector('.channel-item.active'));
      }
      stopRadio();
    }
    function playTvChannel(url, el) {
      if (currentTvUrl === url) return;
      currentTvUrl = url;
      tvChannelsList.querySelectorAll('.channel-item').forEach(ch => ch.classList.remove('active'));
      if(el) el.classList.add('active');

      if (hls) {
        hls.destroy();
        hls = null;
      }
      if (tvVideo.canPlayType('application/vnd.apple.mpegurl')) {
        tvVideo.src = url;
        tvVideo.play().catch(() => {});
      } else if (Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(tvVideo);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {tvVideo.play().catch(() => {});});
      } else {
        tvVideo.src = url;
        tvVideo.play().catch(() => {});
      }
      stopRadio();
    }
    function stopTv() {
      if (hls) { hls.destroy(); hls = null; }
      if (!tvVideo.paused) tvVideo.pause();
      tvVideo.src = '';
      currentTvUrl = null;
      btnTv.classList.remove('active', 'recording');
      btnTv.setAttribute('aria-pressed', 'false');
    }
    // –†–∞–¥–∏–æ —Ñ—É–Ω–∫—Ü–∏–∏
    function showRadio() {
      radioContainer.style.display = 'flex';
      tvContainer.style.display = 'none';
      clearActiveButtons();
      btnRadio.classList.add('active');
      btnRadio.setAttribute('aria-pressed', 'true');
      gamesOverlay.classList.add('hidden');

      if (!currentRadioSrc) {
        const first = radioList.querySelector('.radio-item');
        if (first) playRadioStation(first.dataset.src, first);
      } else {
        playRadioStation(currentRadioSrc, radioList.querySelector('.radio-item.active'));
      }
      stopTv();
    }
    function playRadioStation(src, el) {
      if (currentRadioSrc === src) return;
      currentRadioSrc = src;
      radioList.querySelectorAll('.radio-item').forEach(r => r.classList.remove('active'));
      if(el) el.classList.add('active');

      radioPlayer.src = src;
      radioPlayer.play().catch(() => {});
      stopTv();
    }
    function stopRadio() {
      if (!radioPlayer.paused) radioPlayer.pause();
      radioPlayer.src = '';
      currentRadioSrc = null;
      btnRadio.classList.remove('active');
      btnRadio.setAttribute('aria-pressed', 'false');
      radioList.querySelectorAll('.radio-item').forEach(r => r.classList.remove('active'));
    }
    // –ò–≥—Ä—ã –º–µ–Ω—é
    function openGames() {
      gamesOverlay.classList.remove('hidden');
      gamesOverlay.focus();
      clearActiveButtons();
      btnGames.classList.add('active');
      btnGames.setAttribute('aria-pressed', 'true');
    }
    function closeGames() {
      gamesOverlay.classList.add('hidden');
      btnGames.classList.remove('active');
      btnGames.setAttribute('aria-pressed', 'false');
    }
    // –ò–≥—Ä–æ–≤–æ–µ –æ–∫–Ω–æ
    let gameMinimized = false;
    let gameMuted = false;
    let fullscreenState = false;

    function openGame(url) {
      gameIframe.src = url;
      gameWindow.classList.add('show');
      gameMinimized = false;
      gameMuted = false;
      fullscreenState = false;
      updateGameControls();
      // —Å–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π
      gameWindow.style.width = '';
      gameWindow.style.height = '';
      gameWindow.style.bottom = '';
      gameWindow.style.top = '50%';
      gameWindow.style.left = '50%';
      gameWindow.style.transform = 'translate(-50%, -50%)';
      gameIframe.style.display = 'block';
      gameMinimize.style.display = 'inline-block';
      gameMaximize.style.display = 'none';
      gameFullscreen.style.display = 'inline-block';
      gameFullscreenExit.style.display = 'none';
      closeGames();
    }
    function closeGame() {
      gameWindow.classList.remove('show');
      gameIframe.src = '';
    }
    function minimizeGame() {
      if (gameMinimized) return;
      gameMinimized = true;
      gameWindow.style.top = 'auto';
      gameWindow.style.bottom = '6px';
      gameWindow.style.left = '50%';
      gameWindow.style.width = '420px';
      gameWindow.style.height = '50px';
      gameWindow.style.transform = 'translateX(-50%)';
      gameIframe.style.display = 'none';
      gameMinimize.style.display = 'none';
      gameMaximize.style.display = 'inline-block';
    }
    function maximizeGame() {
      if (!gameMinimized) return;
      gameMinimized = false;
      gameWindow.style.top = '50%';
      gameWindow.style.bottom = 'auto';
      gameWindow.style.left = '50%';
      gameWindow.style.width = '80vw';
      gameWindow.style.height = '80vh';
      gameWindow.style.transform = 'translate(-50%, -50%)';
      gameIframe.style.display = 'block';
      gameMinimize.style.display = 'inline-block';
      gameMaximize.style.display = 'none';
    }
    function toggleSound() {
      gameMuted = !gameMuted;
      try {
        gameIframe.contentWindow.postMessage({action:'mute',muted:gameMuted}, '*');
      } catch {}
      updateGameControls();
    }
    function updateGameControls() {
      gameSoundToggle.style.color = gameMuted ? '#cc0000' : '#aaa';
    }
    function enterFullscreen() {
      if (gameWindow.requestFullscreen) {
        gameWindow.requestFullscreen();
        fullscreenState = true;
        gameFullscreen.style.display = 'none';
        gameFullscreenExit.style.display = 'inline-block';
      }
    }
    function exitFullscreen() {
      if (document.exitFullscreen) {
        document.exitFullscreen();
        fullscreenState = false;
        gameFullscreen.style.display = 'inline-block';
        gameFullscreenExit.style.display = 'none';
      }
    }
    document.addEventListener('fullscreenchange', () => {
      if (!document.fullscreenElement) {
        fullscreenState = false;
        gameFullscreen.style.display = 'inline-block';
        gameFullscreenExit.style.display = 'none';
      }
    });
    // –ó–∞–ø–∏—Å—å –≤–∏–¥–µ–æ –¢–í (–¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –∫–Ω–æ–ø–∫–∏ –¢–í)
    btnTv.addEventListener('dblclick', () => {
      if (tvContainer.style.display === 'flex') {
        if (isRecording) stopRecording();
        else startRecording();
      }
    });
    function startRecording() {
      if (!tvVideo.captureStream) {
        alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤–∏–¥–µ–æ.');
        return;
      }
      const stream = tvVideo.captureStream();
      recordedChunks = [];
      mediaRecorder = new MediaRecorder(stream, {mimeType: 'video/webm; codecs=vp8'});
      mediaRecorder.ondataavailable = e => {
        if (e.data.size > 0) recordedChunks.push(e.data);
      };
      mediaRecorder.onstop = saveRecording;
      mediaRecorder.start();
      isRecording = true;
      btnTv.classList.add('recording');
    }
    function stopRecording() {
      if (mediaRecorder && isRecording) mediaRecorder.stop();
      isRecording = false;
      btnTv.classList.remove('recording');
    }
    function saveRecording() {
      const blob = new Blob(recordedChunks, {type: 'video/webm'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `recording_${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.webm`;
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 150);
    }
    // –°–ª—É—à–∞—Ç–µ–ª–∏
    btnTv.addEventListener('click', showTv);
    btnRadio.addEventListener('click', showRadio);
    btnGames.addEventListener('click', () => {
      if (gamesOverlay.classList.contains('hidden')) openGames();
      else closeGames();
    });
    tvChannelsList.addEventListener('click', e => {
      const target = e.target.closest('.channel-item');
      if (target) playTvChannel(target.dataset.url, target);
    });
    radioList.addEventListener('click', e => {
      const target = e.target.closest('.radio-item');
      if (target) playRadioStation(target.dataset.src, target);
    });
    gamesClose.addEventListener('click', closeGames);
    gamesList.addEventListener('click', e => {
      const target = e.target.closest('.game-item');
      if (target) openGame(target.dataset.url);
    });
    gameClose.addEventListener('click', closeGame);
    gameMinimize.addEventListener('click', minimizeGame);
    gameMaximize.addEventListener('click', maximizeGame);
    gameSoundToggle.addEventListener('click', toggleSound);
    gameFullscreen.addEventListener('click', enterFullscreen);
    gameFullscreenExit.addEventListener('click', exitFullscreen);
    // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ä–∞–¥–∏–æ
    window.addEventListener('load', showRadio);
  })();
</script>
</body>
</html>
